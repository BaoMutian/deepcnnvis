---
name: 深度CNN可视化项目
overview: 构建一个手写字母/数字识别的实时可视化Web应用，包含PyTorch深度CNN模型训练、3D神经网络激活可视化、Grad-CAM热力图，采用Apple风格的简约科技UI设计。
todos:
  - id: init-project
    content: 初始化项目结构、Git仓库、.gitignore
    status: completed
  - id: model-arch
    content: 设计并实现深度CNN模型架构 (model.py)
    status: completed
    dependencies:
      - init-project
  - id: dataset-loader
    content: 实现EMNIST数据集加载与增强 (dataset.py)
    status: completed
    dependencies:
      - init-project
  - id: training-script
    content: 实现完整训练脚本与超参数配置
    status: completed
    dependencies:
      - model-arch
      - dataset-loader
  - id: gradcam-impl
    content: 实现Grad-CAM和中间层激活提取
    status: completed
    dependencies:
      - model-arch
  - id: fastapi-backend
    content: 构建FastAPI后端服务与推理接口
    status: completed
    dependencies:
      - gradcam-impl
  - id: frontend-canvas
    content: 实现手写画布与图像预处理
    status: completed
    dependencies:
      - init-project
  - id: frontend-3d
    content: Three.js 3D神经网络可视化实现
    status: completed
    dependencies:
      - frontend-canvas
  - id: frontend-gradcam
    content: Grad-CAM热力图叠加显示
    status: completed
    dependencies:
      - frontend-canvas
  - id: frontend-ui
    content: Apple风格UI整体布局与样式
    status: completed
    dependencies:
      - frontend-canvas
      - frontend-3d
      - frontend-gradcam
  - id: integration
    content: 前后端联调与实时推理集成
    status: in_progress
    dependencies:
      - fastapi-backend
      - frontend-ui
  - id: train-model
    content: 在RTX 5080上训练模型并保存权重
    status: pending
    dependencies:
      - training-script
---

# 深度CNN可视化交互项目

## 项目架构概览

```mermaid
graph TB
    subgraph frontend [前端 - 原生JS]
        Canvas[手写画布]
        ThreeJS[Three.js 3D可视化]
        GradCAM[Grad-CAM热力图]
        UI[Apple风格UI]
    end
    
    subgraph backend [后端 - FastAPI]
        API[REST API]
        Model[深度CNN模型]
        Activations[中间层激活提取]
        CAM[Grad-CAM计算]
    end
    
    subgraph training [训练模块]
        Dataset[EMNIST数据集]
        Train[PyTorch训练脚本]
        Checkpoint[模型权重]
    end
    
    Canvas -->|WebSocket/HTTP| API
    API --> Model
    Model --> Activations
    Model --> CAM
    Activations -->|JSON| ThreeJS
    CAM -->|Base64| GradCAM
```



## 目录结构

```javascript
deepcnnvis/
├── backend/
│   ├── app/
│   │   ├── __init__.py
│   │   ├── main.py              # FastAPI 入口
│   │   ├── model.py             # CNN模型定义
│   │   ├── inference.py         # 推理逻辑
│   │   └── gradcam.py           # Grad-CAM实现
│   ├── weights/                  # 训练好的模型权重
│   └── requirements.txt
├── training/
│   ├── train.py                  # 训练脚本
│   ├── dataset.py                # EMNIST数据加载
│   └── config.py                 # 超参数配置
├── frontend/
│   ├── index.html
│   ├── css/
│   │   └── style.css             # Apple风格样式
│   └── js/
│       ├── main.js               # 主逻辑
│       ├── canvas.js             # 手写画布
│       ├── network3d.js          # Three.js 3D可视化
│       └── gradcam.js            # 热力图叠加
├── .gitignore
└── README.md
```



## 1. 深度CNN模型设计

设计一个具有较深结构和适量参数的CNN网络（约2-5M参数），专为手写字符识别优化：

```python
# 类VGG+残差结构的深度CNN
class DeepCharCNN(nn.Module):
    # 输入: 1x64x64 灰度图
    # 网络结构:
    # - 初始卷积块: 1 -> 64 channels
    # - 残差块组1: 64 -> 128, 2个残差块
    # - 残差块组2: 128 -> 256, 3个残差块  
    # - 残差块组3: 256 -> 512, 3个残差块
    # - 全局平均池化
    # - 全连接层: 512 -> 256 -> 62类
    # 
    # 特点: BatchNorm, ReLU, Dropout, Skip Connections
```



## 2. 训练流程

- **数据集**: EMNIST ByClass (62类，814k样本)
- **数据增强**: 随机旋转、平移、缩放、弹性变形
- **优化器**: AdamW + Cosine Annealing
- **训练**: RTX 5080上约30-60分钟达到95%+准确率

## 3. 后端API设计

使用 FastAPI 提供高性能异步API：| 端点 | 方法 | 功能 |

|------|------|------|

| `/predict` | POST | 图像推理 + Grad-CAM + 所有层激活 |

| `/health` | GET | 服务健康检查 |响应结构：

```json
{
  "prediction": "A",
  "confidence": 0.97,
  "top5": [["A", 0.97], ["H", 0.02], ...],
  "gradcam": "data:image/png;base64,...",
  "activations": {
    "conv1": {"shape": [64, 32, 32], "data": [...]},
    "res_block1": {"shape": [128, 16, 16], "data": [...]},
    ...
  }
}
```



## 4. 前端3D可视化设计

使用 Three.js 构建分层神经网络3D模型：

```mermaid
graph LR
    Input[输入层<br/>64x64] --> Conv1[卷积层1<br/>64通道]
    Conv1 --> Res1[残差块1<br/>128通道]
    Res1 --> Res2[残差块2<br/>256通道]
    Res2 --> Res3[残差块3<br/>512通道]
    Res3 --> FC[全连接层]
    FC --> Output[输出层<br/>62类]
```



- 每层用3D立方体/平面阵列表示
- 神经元激活强度映射为颜色亮度（冷->热）
- 层间连接线条可选显示
- 支持旋转、缩放、平移交互

## 5. UI/UX设计 (Apple风格)

- **配色**: 白色(#FFFFFF)背景，浅灰(#F5F5F7)卡片，深灰(#1D1D1F)文字
- **字体**: SF Pro Display / Inter
- **动效**: 贝塞尔曲线过渡，微妙阴影
- **布局**: 左侧手写区+结果，右侧3D可视化

## 6. 实施步骤